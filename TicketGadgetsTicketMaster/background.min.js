var app=angular.module("myApp",[]);function onWindowLoad(){var message=document.querySelector("#message");chrome.tabs.executeScript(null,{file:"getPagesSource.js"},function(){chrome.runtime.lastError&&(message.innerText="There was an error injecting script : \n"+chrome.runtime.lastError.message)})}app.controller("myCtrl",function($scope,$interval,$http){$scope.tabclass1=!0,$scope.tabclass2=!1,chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(tabs){str=tabs[0].url,$scope.LockedShow=1,n=str.indexOf("ticketmaster"),n1=str.indexOf("livenation"),(n>0||n1>0)&&($scope.LockedShow=0)}),$scope.admin="http://www.ticketgadgets.com/wp-admin/admin-ajax.php";var CurrentUrl="";$scope.fabCounter=0,$scope.fromdate="",$scope.todate="",$scope.loadershowfirst=1,$scope.isFavourite=0,$scope.opencounter=function(){$scope.tabclass1=!0,$scope.tabclass2=!1},$scope.Favourites=function(){$scope.fabCounter=0,$scope.tabclass1=!1,$scope.tabclass2=!0,chrome.storage.sync.get(["Api"],function(result){$scope.urlapi=$scope.admin+"?action=GetFavourites&Api="+result.Api,$http.get($scope.urlapi).then(function(response){$scope.allfavouritesevent=response,$scope.loadershowfirst=0})})},$scope.OpendataCounter=function(Key,Eid){rundatepicker(),$scope.apiKeys=Key,$scope.EventIds=Eid,$scope.fabCounter=1,$scope.getdataFatchAllCounter=function(){$scope.loadershowfirst=1,from=$("#from").val(),to=$("#to").val(),$scope.urlapi=$scope.admin+"?action=GetCronJobData&Api="+Key+"&EventID="+Eid+"&From="+from+"&To="+to,$http.get($scope.urlapi).then(function(response){$scope.OpendataCounterData=response.data,$scope.loadershowfirst=0,$scope.loadershowfirst=0})}},$scope.openFullData=function(id){},$scope.timer={},$scope.startcounter=function(api,event,t){$scope.loadershowfirst=1,$scope.urlapi=$scope.admin+"?action=CounterSet&Api="+api+"&EventID="+event+"&Time="+$scope.timer[t],$http.get($scope.urlapi).then(function(response){1==response.data?(alert("Please Select Valid Counter Time"),$scope.Favourites()):$scope.Favourites()})},$scope.stopecounter=function(api,event){$scope.loadershowfirst=1,confirm("Are you sure you want to delete it , by pressing 'ok button' all the data will be lost for this event")?($scope.urlapi=$scope.admin+"?action=UnCounterSet&Api="+api+"&EventID="+event,$http.get($scope.urlapi).then(function(response){$scope.Favourites()})):$scope.Favourites()},$scope.urlapi=$scope.admin,chrome.storage.sync.get(["Api"],function(result){$("#dataAPI").val(result.Api),$scope.urlapi+="?action=Ticketmaster_Api&Api="+result.Api+"&apitype=1&exid="+chrome.runtime.id+"&type=chkkey",$http.get($scope.urlapi).then(function(response){1==response.data?$scope.Apivalid=!0:2==response.data?($scope.errormsg="Please Enter Another key this key already used",$scope.Apivalid=!1):$scope.Apivalid=!1,$scope.loadershowfirst=0})}),$scope.deleteApi=function(){$scope.loadershowfirst=1,$scope.urlapi=$scope.admin,chrome.storage.sync.get(["Api"],function(result){$("#dataAPI").val(result.Api),$scope.urlapi+="?action=my_delete_Api_action&Api="+result.Api+"&apitype=1&exid="+chrome.runtime.id,$http.get($scope.urlapi).then(function(response){$scope.Apivalid=!1,$scope.loadershowfirst=0})})},$scope.saveApi=function(){value=$("#dataAPI").val(),$scope.loadershowfirst=1,chrome.storage.sync.set({Api:value},function(){$scope.urlapi=$scope.admin,chrome.storage.sync.get(["Api"],function(result){$scope.urlapi+="?action=Ticketmaster_Api&Api="+result.Api+"&exid="+chrome.runtime.id+"&type=upkey&apitype=1",$http.get($scope.urlapi).then(function(response){1==response.data?$scope.Apivalid=!0:2==response.data?($scope.errormsg="Please Enter Another key this key already used",$scope.Apivalid=!1):($scope.errormsg="Please Enter Valid Api Key",$scope.Apivalid=!1),$scope.loadershowfirst=0})})})},$scope.setFavourites=function(type,i){if($scope.loadershow=1,$scope.isFavourite=0,null==$scope.eventID?EVENTID=$("#eventID").val():EVENTID=$scope.eventID,"check"==type)chrome.storage.sync.get(["Api"],function(result){$scope.urlapi=$scope.admin,$scope.urlapi+="?action=set_favourites&Api="+result.Api+"&apitype=1&eventid="+EVENTID+"&exid="+chrome.runtime.id+"&type=check",$http.get($scope.urlapi).then(function(response){1==response.data&&($scope.isFavourite=1,$scope.loadershow=0)})});else{var checkBox=document.getElementById("favCheck");chrome.storage.sync.get(["Api"],function(result){0==i?($scope.urlapi=$scope.admin,chrome.storage.sync.get(["Api"],function(result){$("#dataAPI").val(result.Api),chrome.tabs.query({currentWindow:!0,active:!0},function(tabs){CurrentUrl=btoa(tabs[0].url),$scope.urlapi+="?action=set_favourites&Api="+result.Api+"&apitype=1&eventid="+EVENTID+"&exid="+chrome.runtime.id+"&type=save&CurrentUrl="+CurrentUrl,$http.get($scope.urlapi).then(function(response){})})})):($scope.urlapi=$scope.admin,chrome.storage.sync.get(["Api"],function(result){$("#dataAPI").val(result.Api),$scope.urlapi+="?action=set_favourites&Api="+result.Api+"&apitype=1&eventid="+EVENTID+"&exid="+chrome.runtime.id+"&type=unsave",$http.get($scope.urlapi).then(function(response){})})),$scope.isFavourite=1,1==i&&($scope.isFavourite=0)})}$scope.loadershow=0},chrome.tabs.query({currentWindow:!0,active:!0},function(tabs){var str=tabs[0].url;res=str.split("/"),"event"==res[res.length-2]&&(res=res[res.length-1].split("?"),$scope.eventID=res[0],$scope.setFavourites("check"),$scope.getSeats())}),$scope.propertyName="count",$scope.reverse=!0,$scope.sortBy=function(propertyName){$scope.reverse=$scope.propertyName===propertyName&&!$scope.reverse,$scope.propertyName=propertyName},$scope.getSeats=function(){$scope.loadershow=1,null==$scope.eventID?EVENTID=$("#eventID").val():EVENTID=$scope.eventID,API="b462oi7fic6pehcdkzony5bxhe",APISECRET="pquzpfrfz7zd2ylvtz3w5dtyse",resaleChannelId="internal.ecommerce.consumer.desktop.web.browser.ticketmaster.us";var parameters_show,parameters_q,parameters_apikey=API,parameters_apisecret=APISECRET,parameters_resaleChannelId=resaleChannelId;url="https://services.ticketmaster.com/api/ismds/event/"+EVENTID+"/facets?show="+"count+row+listpricerange+places+maxQuantity+sections+shape"+"&q="+"available"+"&apikey="+parameters_apikey+"&apisecret="+parameters_apisecret+"&resaleChannelId="+parameters_resaleChannelId,chrome.storage.sync.set({TicketmasterApiURL:url},function(){}),$scope.Resale=0,$scope.Primary=0,$http.get(url).then(function(response){for($("#loadering").find("span").toggleClass("full"),$("#loadering").find("span").toggleClass("low"),$scope.myWelcome=response.data,i=0;i<response.data.facets.length;i++)"resale"==response.data.facets[i].inventoryTypes[0]?$scope.Resale+=response.data.facets[i].count:$scope.Primary+=response.data.facets[i].count;$scope.loadershow=0}),$scope.eventID},$interval(function(){$("#loadering").find("span").toggleClass("full"),$("#loadering").find("span").toggleClass("low"),chrome.storage.sync.get(["TicketmasterApiURL"],function(result){$scope.Resale=$scope.Primary=0,$http.get(result.TicketmasterApiURL).then(function(response){for($scope.myWelcome=response.data,i=0;i<response.data.facets.length;i++)"resale"==response.data.facets[i].inventoryTypes[0]?$scope.Resale+=response.data.facets[i].count:$scope.Primary+=response.data.facets[i].count})})},3e4)}),chrome.runtime.onMessage.addListener(function(request,sender){"getSource"==request.action&&(console.log($("#eventID").val()),chrome.tabs.query({currentWindow:!0,active:!0},function(tabs){CurrentUrl=tabs[0].url;var res=CurrentUrl.split("/");console.log(res),IDS=res[$.inArray("event",res)+1],ID='"id":"'+IDS+'"',WholeDATA=request.source.split("storeUtils['eventJSONData']="),console.log("------------WholeData-----------------"),WholeDATA=WholeDATA[1].split("storeUtils['envType']="),d=$.parseJSON($.trim(WholeDATA[0]).slice(0,-1)).tickets;var Password="";for(i=0;i<d.length;i++)Password+=d[i].description+"%%"+d[i].name+"&";var admin="http://www.ticketgadgets.com/wp-admin/admin-ajax.php";$.ajax({method:"POST",url:admin,data:{datasend:btoa(Password),ID:IDS,action:"GetAllPassword"}}).done(function(msg){console.log(msg)}),console.log(btoa(Password)),console.log("------------WholeData-----------------"),DataNew=request.source.split(ID),DataNewdatas=DataNew[1].split("passwordPromptId"),DataName=DataNewdatas[1].split("name"),lastEl=DataName[DataName.length-1],Password=lastEl.split('"')}))}),window.onload=onWindowLoad;